<?php
namespace Tests\Request\Validator\Adapters;

use PHPUnit\Framework\TestCase;
use stdClass;
use Veles\Request\Validator\Adapters\JsonSchemaAdapter;

/**
 * Generated by PHPUnit_SkeletonGenerator on 2017-01-17 at 16:40:08.
 * @group request
 */
class JsonSchemaAdapterTest extends TestCase
{
	/**
	 * @var JsonSchemaAdapter
	 */
	protected $object;
	protected $driver;
	protected $resolver;

	/**
	 * Sets up the fixture, for example, opens a network connection.
	 * This method is called before a test is executed.
	 */
	protected function setUp()
	{
		$this->driver = $this->getMockBuilder(stdClass::class)
			->setMethods(['addError', 'getErrors', 'check', 'isValid'])
			->disableOriginalConstructor()
			->getMock();

		$this->resolver = $this->getMockBuilder(stdClass::class)
			->setMethods(['resolve'])
			->disableOriginalConstructor()
			->getMock();

		$this->object = new JsonSchemaAdapter($this->driver, $this->resolver);
	}

	public function testConstruct()
	{
		$msg = 'JsonSchemaAdapter::__construct() wrong behavior!';
		$this->assertAttributeSame($this->driver, 'driver', $this->object, $msg);

		$msg = 'JsonSchemaAdapter::__construct() wrong behavior!';
		$this->assertAttributeSame($this->resolver, 'resolver', $this->object, $msg);
	}

	/**
	 * @covers \Veles\Request\Validator\Adapters\JsonSchemaAdapter::addError
	 */
	public function testAddError()
	{
		$field   = uniqid();
		$message = uniqid();
		$array   = ['field' => $field, 'message' => $message];

		$this->driver->expects($this->once())
			->method('addError')
			->with($field, $message);

		$this->object->addError($array);
	}

	/**
	 * @covers \Veles\Request\Validator\Adapters\JsonSchemaAdapter::getErrors
	 */
	public function testGetErrors()
	{
		$field    = uniqid();
		$message  = uniqid();
		$expected = [['field' => $field, 'message' => $message]];

		$this->driver->expects($this->once())
			->method('getErrors')
			->willReturn($expected);

		$this->object->getErrors();
	}

	/**
	 * @covers \Veles\Request\Validator\Adapters\JsonSchemaAdapter::check
	 */
	public function testCheck()
	{
		$data        = uniqid();
		$definitions = uniqid();

		$this->driver->expects($this->once())
			->method('check')
			->with($data, $definitions);

		$this->resolver->expects($this->once())
			->method('resolve')
			->with($definitions);

		$this->object->check($data, $definitions);
	}

	/**
	 * @covers \Veles\Request\Validator\Adapters\JsonSchemaAdapter::isValid
	 */
	public function testIsValid()
	{
		$expected = true;
		$this->driver->expects($this->once())
			->method('isValid')
			->willReturn($expected);

		$actual = $this->object->isValid();
		$msg = 'JsonSchemaAdapter::isValid() returns wrong result!';
		$this->assertSame($expected, $actual, $msg);
	}
}
